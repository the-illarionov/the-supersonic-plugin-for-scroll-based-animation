var t=Object.defineProperty,e=(e,s,i)=>(((e,s,i)=>{s in e?t(e,s,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[s]=i})(e,"symbol"!=typeof s?s+"":s,i),i);class s{constructor({id:t,cssAnimation:s,hooks:i,driver:o,domElement:n}){e(this,"id"),e(this,"cssAnimation"),e(this,"data",{}),e(this,"driver"),e(this,"domElement"),e(this,"hooks"),this.id=t,this.driver=o,this.cssAnimation=s,this.hooks=i,this.domElement=n,this.hooks.onInit&&this.hooks.onInit(this)}render({driverProgress:t}){let e=1e4*t;if(this.hooks.onBeforeRender){const t=this.hooks.onBeforeRender(this);if("number"==typeof t)e=t;else if("boolean"==typeof t&&!t)return!1}this.cssAnimation.currentTime=e,this.hooks.onAfterRender&&this.hooks.onAfterRender(this)}}class i{constructor({id:t,start:i,end:r,pluginId:h,elements:d=[],hooks:l={}}){e(this,"id"),e(this,"progress",0),e(this,"data",{}),e(this,"start"),e(this,"end"),e(this,"pluginId"),e(this,"animations",new Map),e(this,"domElements",[]),e(this,"helper"),e(this,"hooks"),this.id=t,this.pluginId=h,this.hooks=l,this.hooks.onBeforeInit&&this.hooks.onBeforeInit(this),this.start=new o({domElement:i,type:"start",driver:this}),this.end=new o({domElement:r,type:"end",driver:this}),this.helper=new n({id:this.id,pluginId:this.pluginId}),d.forEach((t=>{const e="string"==typeof t?t:t.selector;if(this.domElements=Array.from(document.querySelectorAll(e)),0===this.domElements.length)throw new Error(`Can't find element "${e}"`);this.domElements.forEach(((i,o)=>{const n=i.getAnimations(),r=[];"string"==typeof t?(n.length,n.forEach((t=>{r.push({cssAnimation:t,hooks:{}})}))):"object"==typeof t&&t.animations.forEach((t=>{let e="",s={};"string"==typeof t?e=t:"object"==typeof t&&(e=t.name,s=t.hooks);const i=n.find((t=>t.animationName===e));i&&r.push({cssAnimation:i,hooks:s})})),r.forEach((t=>{const n=`${this.id}---${e}---${o}---${t.cssAnimation.animationName}`,r=new s({id:n,driver:this,cssAnimation:t.cssAnimation,hooks:t.hooks,domElement:i});this.animations.set(n,r)}))}))})),this.hooks.onAfterInit&&this.hooks.onAfterInit(this)}render({scroll:t,renderedInitially:e,consoleColor:s="#000000"}){const i=this.progress;if(this.progress=this.calculateProgress({scroll:t,start:this.start.top,end:this.end.top}),this.hooks.onBeforeRender){const t=this.hooks.onBeforeRender(this);if("boolean"==typeof t&&!t)return!1}if(i!==this.progress||!e){for(const t of this.animations.values())t.render({driverProgress:this.progress});this.hooks.onAfterRender&&this.hooks.onAfterRender(this)}}calculateProgress({scroll:t,start:e,end:s}){let i=(t-e)/(s-e);return i=i<0?0:i>1?1:function(t,e){return~~(t*(e=10**e))/e}(i,4),i}updateLimits({scroll:t,screenHeight:e}){this.start.updateLimits({scroll:t,screenHeight:e}),this.end.updateLimits({scroll:t,screenHeight:e}),this.helper.updateLimits({top:this.start.top,bottom:this.end.top,screenHeight:e}),this.hooks.onUpdateLimits&&this.hooks.onUpdateLimits(this)}activate(){this.hooks.onActivation&&this.hooks.onActivation(this)}deactivate(){this.hooks.onDeactivation&&this.hooks.onDeactivation(this)}}class o{constructor({domElement:t,type:s,driver:i}){if(e(this,"domElement"),e(this,"top",0),!t)throw new Error(`Can't find "${s}" HTMLElement for driver "${i.id}"`);this.domElement=t}updateLimits({scroll:t,screenHeight:e}){this.top=~~this.domElement.getBoundingClientRect().top+t-e}}class n{constructor({id:t,pluginId:s}){e(this,"domElement"),e(this,"pluginId"),this.pluginId=s,this.domElement=document.createElement("i"),this.domElement.style.position="absolute",this.domElement.style.left="0",this.domElement.style.width="1px",this.domElement.setAttribute("data-supersonic-driver",t),this.domElement.setAttribute("data-supersonic-type","helper"),this.domElement.setAttribute("data-supersonic-plugin-id",this.pluginId),this.domElement.classList.add("supersonic-helper"),document.body.appendChild(this.domElement)}updateLimits({top:t,bottom:e,screenHeight:s}){this.domElement.style.setProperty("top",`${t+s}px`);let i=e-(t+s);i<=0&&(i=1),this.domElement.style.setProperty("height",`${i}px`)}uninit(){this.domElement.remove()}}class r{constructor({observables:t,driverInstances:s,driverActiveInstances:i}){e(this,"instance"),this.instance=new IntersectionObserver((t=>{t.forEach((t=>{const e=t.target.dataset.supersonicDriver,o=s.get(e);if(!o)throw new Error(`Observer can't find driver "${e}"`);t.isIntersecting?(i.add(o),o.activate()):(i.delete(o),o.deactivate())}))})),t.forEach((t=>{this.instance.observe(t)}))}uninit(){this.instance.disconnect()}}class h{constructor({drivers:t,hooks:s={}}){var o,n;e(this,"id"),e(this,"scroll",0),e(this,"screenHeight",0),e(this,"renderedInitially",!1),e(this,"rafId",0),e(this,"consoleColor","#ffffff"),e(this,"observer",null),e(this,"onResize",null),e(this,"hooks",{}),e(this,"driverInstances",new Map),e(this,"driverActiveInstances",new Set),this.id=Math.random().toString(16).substring(2),this.hooks=s,null!=(o=this.hooks)&&o.onBeforeInit&&this.hooks.onBeforeInit(this);for(const e in t){const s=new i({id:e,hooks:t[e].hooks,start:t[e].start,end:t[e].end,elements:t[e].elements,pluginId:this.id});this.driverInstances.set(e,s)}this.updateLimits();const h=Array.from(document.querySelectorAll(`[data-supersonic-type="helper"][data-supersonic-plugin-id="${this.id}"]`));this.observer=new r({observables:h,driverInstances:this.driverInstances,driverActiveInstances:this.driverActiveInstances});this.onResize=function(t,e){let s;return function(){clearTimeout(s),s=setTimeout((()=>t.apply(this)),e)}}((()=>{var t;null!=(t=this.hooks)&&t.onBeforeResize&&this.hooks.onBeforeResize(this),this.updateLimits(),this.render({useActiveDrivers:!1}),this.hooks.onAfterResize&&this.hooks.onAfterResize(this)}),250),window.addEventListener("resize",this.onResize),this.render({useActiveDrivers:!1}),this.renderedInitially=!0,null!=(n=this.hooks)&&n.onAfterInit&&this.hooks.onAfterInit(this)}uninit(){for(const t of this.driverInstances.values())t.helper.uninit();this.driverInstances.clear(),this.driverActiveInstances.clear(),this.observer.uninit(),cancelAnimationFrame(this.rafId),window.removeEventListener("resize",this.onResize)}render({useActiveDrivers:t}){if(this.updateScroll(),this.hooks.onBeforeRender){const t=this.hooks.onBeforeRender(this);if("boolean"==typeof t&&!t)return!1}const e=t?this.driverActiveInstances.values():this.driverInstances.values();for(const t of e)t.render({scroll:this.scroll,renderedInitially:this.renderedInitially,consoleColor:this.consoleColor});this.rafId=requestAnimationFrame((()=>{this.render({useActiveDrivers:!0})})),this.hooks.onAfterRender&&this.hooks.onAfterRender(this)}updateLimits(){this.updateScreenHeight(),this.updateScroll();for(const t of this.driverInstances.values())t.updateLimits({scroll:this.scroll,screenHeight:this.screenHeight})}updateScroll(){this.scroll=window.scrollY||document.documentElement.scrollTop}updateScreenHeight(){const t={position:"absolute",left:"0",top:"0",height:"100vh",width:"1px",zIndex:"-1",visibility:"hidden"},e=document.createElement("div");for(const s in t)e.style.setProperty(s,t[s]);document.body.appendChild(e),this.screenHeight=e.clientHeight,e.remove()}}export{s as Animation,i as Driver,h as TheSuperSonicPlugin};

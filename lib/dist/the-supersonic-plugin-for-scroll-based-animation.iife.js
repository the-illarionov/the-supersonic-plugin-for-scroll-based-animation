var TheSupersonicPluginWrapper=function(d){"use strict";var x=Object.defineProperty;var z=(d,a,m)=>a in d?x(d,a,{enumerable:!0,configurable:!0,writable:!0,value:m}):d[a]=m;var s=(d,a,m)=>(z(d,typeof a!="symbol"?a+"":a,m),m);function a(c,e){return e=10**e,~~(c*e)/e}function m(c,e){let t;return function(){clearTimeout(t),t=setTimeout(()=>c.apply(this),e)}}class E{constructor({id:e,cssAnimation:t,hooks:i,driver:o,domElement:n}){s(this,"id");s(this,"cssAnimation");s(this,"data",{});s(this,"driver");s(this,"domElement");s(this,"hooks");this.id=e,this.driver=o,this.cssAnimation=t,this.hooks=i,this.domElement=n,this.hooks.onInit&&this.hooks.onInit({animation:this})}render({driverProgress:e}){let t=e*1e4;if(this.hooks.onBeforeRender){const i=this.hooks.onBeforeRender({animation:this});if(typeof i=="number")t=i;else if(typeof i=="boolean"&&!i)return!1}this.cssAnimation.currentTime=t,this.hooks.onAfterRender&&this.hooks.onAfterRender({animation:this})}}const p={colors:["red","blue","orange","yellow"],colorIndex:0};class A{constructor({id:e,start:t,end:i,plugin:o,elements:n=[],hooks:u={}}){s(this,"id");s(this,"progress",0);s(this,"data",{});s(this,"start");s(this,"end");s(this,"plugin");s(this,"animations",new Map);s(this,"domElements",[]);s(this,"helper");s(this,"hooks");this.id=e,this.plugin=o,this.hooks=u,this.hooks.onBeforeInit&&this.hooks.onBeforeInit({driver:this}),this.start=new I({domElement:t,type:"start",driver:this}),this.end=new I({domElement:i,type:"end",driver:this}),this.helper=new R({id:e,pluginId:this.plugin.id,debug:o.debug}),n.forEach(r=>{const h=typeof r=="string"?r:r.selector;if(this.domElements=Array.from(document.querySelectorAll(h)),this.domElements.length===0)throw new Error(`Can't find element "${h}"`);this.domElements.forEach((v,S)=>{const y=v.getAnimations(),k=[];typeof r=="string"?(y.length,y.forEach(l=>{k.push({cssAnimation:l,hooks:{}})})):typeof r=="object"&&r.animations.forEach(l=>{let f="",g={};typeof l=="string"?f=l:typeof l=="object"&&(f=l.name,g=l.hooks);const b=y.find(L=>L.animationName===f);b&&k.push({cssAnimation:b,hooks:g})}),k.forEach(l=>{const f=`${this.id}---${h}---${S}---${l.cssAnimation.animationName}`,g=new E({id:f,driver:this,cssAnimation:l.cssAnimation,hooks:l.hooks,domElement:v});this.animations.set(f,g)})})}),this.hooks.onAfterInit&&this.hooks.onAfterInit({driver:this})}render({scroll:e,renderedInitially:t,consoleColor:i="#000000"}){const o=this.progress;if(this.progress=this.calculateProgress({scroll:e,start:this.start.top,end:this.end.top}),this.hooks.onBeforeRender){const n=this.hooks.onBeforeRender({driver:this});if(typeof n=="boolean"&&!n)return!1}if(o!==this.progress||!t){for(const n of this.animations.values())n.render({driverProgress:this.progress});this.hooks.onAfterRender&&this.hooks.onAfterRender({driver:this})}}calculateProgress({scroll:e,start:t,end:i}){let o=(e-t)/(i-t);return o<0?o=0:o>1?o=1:o=a(o,4),o}updateLimits({scroll:e,screenHeight:t}){this.start.updateLimits({scroll:e,screenHeight:t}),this.end.updateLimits({scroll:e,screenHeight:t});const i=this.start.top+t,o=this.end.top-i;this.helper.updateLimits({top:i,height:o-i}),this.hooks.onUpdateLimits&&this.hooks.onUpdateLimits({driver:this})}activate(){this.plugin.driverActiveInstances.add(this),this.hooks.onActivation&&this.hooks.onActivation({driver:this})}deactivate(){this.plugin.driverActiveInstances.delete(this),this.hooks.onDeactivation&&this.hooks.onDeactivation({driver:this})}}class I{constructor({domElement:e,type:t,driver:i}){s(this,"domElement");s(this,"top",0);if(!e)throw new Error(`Can't find "${t}" HTMLElement for driver "${i.id}"`);this.domElement=e}updateLimits({scroll:e,screenHeight:t}){this.top=~~this.domElement.getBoundingClientRect().top+e-t}}class R{constructor({id:e,pluginId:t,debug:i=!1}){s(this,"domElement");s(this,"pluginId");s(this,"debug");if(this.pluginId=t,this.debug=i,this.domElement=document.createElement("i"),this.domElement.style.position="absolute",this.domElement.style.left="0",this.domElement.style.width="1px",this.domElement.setAttribute("data-supersonic-driver",e),this.domElement.setAttribute("data-supersonic-type","helper"),this.domElement.setAttribute("data-supersonic-plugin-id",this.pluginId),this.domElement.classList.add("supersonic-helper"),document.body.appendChild(this.domElement),i){const n=Array.from(document.querySelectorAll("[data-supersonic-type='helper']")).indexOf(this.domElement);this.domElement.style.left=`${n*10}px`,this.domElement.style.width="10px",this.domElement.style.minHeight="50px",this.domElement.style.background=p.colors[p.colorIndex],this.domElement.style.zIndex="100000",p.colorIndex===3?p.colorIndex=0:p.colorIndex++,this.domElement.style.opacity="0.75"}}updateLimits({top:e,height:t}){t<=0&&(t=1),this.domElement.style.setProperty("top",`${e}px`),this.domElement.style.setProperty("height",`${t}px`)}uninit(){this.domElement.remove()}}class w{constructor({observables:e,driverInstances:t}){s(this,"instance");this.instance=new IntersectionObserver(i=>{i.forEach(o=>{const u=o.target.dataset.supersonicDriver,r=t.get(u);if(!r)throw new Error(`Observer can't find driver "${u}"`);o.isIntersecting?r.activate():r.deactivate()})}),e.forEach(i=>{this.instance.observe(i)})}uninit(){this.instance.disconnect()}}class B{constructor({drivers:e,hooks:t={},debug:i=!1}){s(this,"id");s(this,"scroll",0);s(this,"screenHeight",0);s(this,"renderedInitially",!1);s(this,"rafId",0);s(this,"consoleColor","#ffffff");s(this,"observer",null);s(this,"onResize",null);s(this,"data",{});s(this,"debug");s(this,"hooks",{});s(this,"driverInstances",new Map);s(this,"driverActiveInstances",new Set);var u,r;this.id=Math.random().toString(16).substring(2),this.hooks=t,this.debug=i,(u=this.hooks)!=null&&u.onBeforeInit&&this.hooks.onBeforeInit({plugin:this});for(const h in e){const v=new A({id:h,hooks:e[h].hooks,start:e[h].start,end:e[h].end,elements:e[h].elements,plugin:this});this.driverInstances.set(h,v)}this.updateLimits();const o=Array.from(document.querySelectorAll(`[data-supersonic-type="helper"][data-supersonic-plugin-id="${this.id}"]`));this.observer=new w({observables:o,driverInstances:this.driverInstances});const n=()=>{var h;(h=this.hooks)!=null&&h.onBeforeResize&&this.hooks.onBeforeResize({plugin:this}),this.updateLimits(),this.render({useActiveDrivers:!1}),this.hooks.onAfterResize&&this.hooks.onAfterResize({plugin:this})};this.onResize=m(n,250),window.addEventListener("resize",this.onResize),this.render({useActiveDrivers:!1}),this.renderedInitially=!0,(r=this.hooks)!=null&&r.onAfterInit&&this.hooks.onAfterInit({plugin:this})}uninit(){for(const e of this.driverInstances.values())e.helper.uninit();this.driverInstances.clear(),this.driverActiveInstances.clear(),this.observer.uninit(),cancelAnimationFrame(this.rafId),window.removeEventListener("resize",this.onResize)}render({useActiveDrivers:e}){if(this.updateScroll(),this.hooks.onBeforeRender){const i=this.hooks.onBeforeRender({plugin:this});if(typeof i=="boolean"&&!i)return!1}const t=e?this.driverActiveInstances.values():this.driverInstances.values();for(const i of t)i.render({scroll:this.scroll,renderedInitially:this.renderedInitially,consoleColor:this.consoleColor});this.rafId=requestAnimationFrame(()=>{this.render({useActiveDrivers:!0})}),this.hooks.onAfterRender&&this.hooks.onAfterRender({plugin:this})}updateLimits(){this.updateScreenHeight(),this.updateScroll();for(const e of this.driverInstances.values())e.updateLimits({scroll:this.scroll,screenHeight:this.screenHeight})}updateScroll(){this.scroll=window.scrollY||document.documentElement.scrollTop}updateScreenHeight(){const e={position:"absolute",left:"0",top:"0",height:"100vh",width:"1px",zIndex:"-1",visibility:"hidden"},t=document.createElement("div");for(const i in e)t.style.setProperty(i,e[i]);document.body.appendChild(t),this.screenHeight=t.clientHeight,t.remove()}}return d.Animation=E,d.Driver=A,d.TheSupersonicPlugin=B,Object.defineProperty(d,Symbol.toStringTag,{value:"Module"}),d}({});

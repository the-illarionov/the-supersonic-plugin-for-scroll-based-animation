var TheSuperSonicPluginWrapper=function(h){"use strict";var L=Object.defineProperty;var z=(h,l,f)=>l in h?L(h,l,{enumerable:!0,configurable:!0,writable:!0,value:f}):h[l]=f;var s=(h,l,f)=>(z(h,typeof l!="symbol"?l+"":l,f),f);function l(c,e){return e=10**e,~~(c*e)/e}function f(c,e){let t;return function(){clearTimeout(t),t=setTimeout(()=>c.apply(this),e)}}class g{constructor({id:e,cssAnimation:t,hooks:i,driver:o,domElement:r}){s(this,"id");s(this,"cssAnimation");s(this,"data",{});s(this,"driver");s(this,"domElement");s(this,"hooks");this.id=e,this.driver=o,this.cssAnimation=t,this.hooks=i,this.domElement=r,this.hooks.onInit&&this.hooks.onInit(this)}render({driverProgress:e}){if(this.hooks.onBeforeRender){const t=this.hooks.onBeforeRender(this);if(typeof t<"u"&&!t)return!1}this.cssAnimation.currentTime=e*1e4,this.hooks.onAfterRender&&this.hooks.onAfterRender(this)}}class A{constructor({id:e,start:t,end:i,pluginId:o,elements:r=[],hooks:u={}}){s(this,"id");s(this,"progress",0);s(this,"data",{});s(this,"start");s(this,"end");s(this,"pluginId");s(this,"animations",new Map);s(this,"domElements",[]);s(this,"helper");s(this,"hooks");this.id=e,this.pluginId=o,this.hooks=u,this.hooks.onBeforeInit&&this.hooks.onBeforeInit(this),this.start=new I({domElement:t,type:"start",driver:this}),this.end=new I({domElement:i,type:"end",driver:this}),this.helper=new R({id:this.id,pluginId:this.pluginId}),r.forEach(n=>{const d=typeof n=="string"?n:n.selector;if(this.domElements=Array.from(document.querySelectorAll(d)),this.domElements.length===0)throw new Error(`Can't find element "${d}"`);this.domElements.forEach((E,S)=>{const v=E.getAnimations(),k=[];typeof n=="string"?(v.length,v.forEach(a=>{k.push({cssAnimation:a,hooks:{}})})):typeof n=="object"&&n.animations.forEach(a=>{let m="",p={};typeof a=="string"?m=a:typeof a=="object"&&(m=a.name,p=a.hooks);const y=v.find(B=>B.animationName===m);y&&k.push({cssAnimation:y,hooks:p})}),k.forEach(a=>{const m=`${this.id}---${d}---${S}---${a.cssAnimation.animationName}`,p=new g({id:m,driver:this,cssAnimation:a.cssAnimation,hooks:a.hooks,domElement:E});this.animations.set(m,p)})})}),this.hooks.onAfterInit&&this.hooks.onAfterInit(this)}render({scroll:e,renderedInitially:t,consoleColor:i="#000000"}){const o=this.progress;if(this.progress=this.calculateProgress({scroll:e,start:this.start.top,end:this.end.top}),this.hooks.onBeforeRender){const r=this.hooks.onBeforeRender(this);if(typeof r<"u"&&!r)return!1}if(o!==this.progress||!t){for(const r of this.animations.values())r.render({driverProgress:this.progress});this.hooks.onAfterRender&&this.hooks.onAfterRender(this)}}calculateProgress({scroll:e,start:t,end:i}){let o=(e-t)/(i-t);return o<0?o=0:o>1?o=1:o=l(o,4),o}updateLimits({scroll:e,screenHeight:t}){this.start.updateLimits({scroll:e,screenHeight:t}),this.end.updateLimits({scroll:e,screenHeight:t}),this.helper.updateLimits({top:this.start.top,bottom:this.end.top,screenHeight:t}),this.hooks.onUpdateLimits&&this.hooks.onUpdateLimits(this)}activate(){this.hooks.onActivation&&this.hooks.onActivation(this)}deactivate(){this.hooks.onDeactivation&&this.hooks.onDeactivation(this)}}class I{constructor({domElement:e,type:t,driver:i}){s(this,"domElement");s(this,"top",0);if(!e)throw new Error(`Can't find "${t}" HTMLElement for driver "${i.id}"`);this.domElement=e}updateLimits({scroll:e,screenHeight:t}){this.top=~~this.domElement.getBoundingClientRect().top+e-t}}class R{constructor({id:e,pluginId:t}){s(this,"domElement");s(this,"pluginId");this.pluginId=t,this.domElement=document.createElement("i"),this.domElement.style.position="absolute",this.domElement.style.left="0",this.domElement.style.width="1px",this.domElement.setAttribute("data-supersonic-driver",e),this.domElement.setAttribute("data-supersonic-type","helper"),this.domElement.setAttribute("data-supersonic-plugin-id",this.pluginId),this.domElement.classList.add("supersonic-helper"),document.body.appendChild(this.domElement)}updateLimits({top:e,bottom:t,screenHeight:i}){this.domElement.style.setProperty("top",`${e+i}px`);let o=t-(e+i);o<=0&&(o=1),this.domElement.style.setProperty("height",`${o}px`)}uninit(){this.domElement.remove()}}class b{constructor({observables:e,driverInstances:t,driverActiveInstances:i}){s(this,"instance");this.instance=new IntersectionObserver(o=>{o.forEach(r=>{const n=r.target.dataset.supersonicDriver,d=t.get(n);if(!d)throw new Error(`Observer can't find driver "${n}"`);r.isIntersecting?(i.add(d),d.activate()):(i.delete(d),d.deactivate())})}),e.forEach(o=>{this.instance.observe(o)})}uninit(){this.instance.disconnect()}}class w{constructor({drivers:e,hooks:t={}}){s(this,"id");s(this,"scroll",0);s(this,"screenHeight",0);s(this,"renderedInitially",!1);s(this,"rafId",0);s(this,"consoleColor","#ffffff");s(this,"observer",null);s(this,"onResize",null);s(this,"hooks",{});s(this,"driverInstances",new Map);s(this,"driverActiveInstances",new Set);var r,u;this.id=Math.random().toString(16).substring(2),this.hooks=t,(r=this.hooks)!=null&&r.onBeforeInit&&this.hooks.onBeforeInit(this);for(const n in e){const d=new A({id:n,hooks:e[n].hooks,start:e[n].start,end:e[n].end,elements:e[n].elements,pluginId:this.id});this.driverInstances.set(n,d)}this.updateLimits();const i=Array.from(document.querySelectorAll(`[data-supersonic-type="helper"][data-supersonic-plugin-id="${this.id}"]`));this.observer=new b({observables:i,driverInstances:this.driverInstances,driverActiveInstances:this.driverActiveInstances});const o=()=>{var n;(n=this.hooks)!=null&&n.onBeforeResize&&this.hooks.onBeforeResize(this),this.updateLimits(),this.render({useActiveDrivers:!1}),this.hooks.onAfterResize&&this.hooks.onAfterResize(this)};this.onResize=f(o,250),window.addEventListener("resize",this.onResize),this.render({useActiveDrivers:!1}),this.renderedInitially=!0,(u=this.hooks)!=null&&u.onAfterInit&&this.hooks.onAfterInit(this)}uninit(){for(const e of this.driverInstances.values())e.helper.uninit();this.driverInstances.clear(),this.driverActiveInstances.clear(),this.observer.uninit(),cancelAnimationFrame(this.rafId),window.removeEventListener("resize",this.onResize)}render({useActiveDrivers:e}){if(this.updateScroll(),this.hooks.onBeforeRender){const i=this.hooks.onBeforeRender(this);if(typeof i<"u"&&!i)return!1}const t=e?this.driverActiveInstances.values():this.driverInstances.values();for(const i of t)i.render({scroll:this.scroll,renderedInitially:this.renderedInitially,consoleColor:this.consoleColor});this.rafId=requestAnimationFrame(()=>{this.render({useActiveDrivers:!0})}),this.hooks.onAfterRender&&this.hooks.onAfterRender(this)}updateLimits(){this.updateScreenHeight(),this.updateScroll();for(const e of this.driverInstances.values())e.updateLimits({scroll:this.scroll,screenHeight:this.screenHeight})}updateScroll(){this.scroll=window.scrollY||document.documentElement.scrollTop}updateScreenHeight(){const e={position:"absolute",left:"0",top:"0",height:"100vh",width:"1px",zIndex:"-1",visibility:"hidden"},t=document.createElement("div");for(const i in e)t.style.setProperty(i,e[i]);document.body.appendChild(t),this.screenHeight=t.clientHeight,t.remove()}}return h.Animation=g,h.Driver=A,h.TheSuperSonicPlugin=w,Object.defineProperty(h,Symbol.toStringTag,{value:"Module"}),h}({});

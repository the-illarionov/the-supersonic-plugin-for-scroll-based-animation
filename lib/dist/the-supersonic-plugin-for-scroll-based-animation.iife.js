var TheSupersonicPluginWrapper=function(h){"use strict";var S=Object.defineProperty;var z=(h,l,c)=>l in h?S(h,l,{enumerable:!0,configurable:!0,writable:!0,value:c}):h[l]=c;var s=(h,l,c)=>(z(h,typeof l!="symbol"?l+"":l,c),c);function l(a,e){return e=10**e,~~(a*e)/e}function c(a,e){let t;return function(){clearTimeout(t),t=setTimeout(()=>a.apply(this),e)}}class k{constructor({id:e,cssAnimation:t,hooks:i,driver:o,domElement:r}){s(this,"id");s(this,"cssAnimation");s(this,"data",{});s(this,"driver");s(this,"domElement");s(this,"hooks");this.id=e,this.driver=o,this.cssAnimation=t,this.hooks=i,this.domElement=r,this.hooks.onInit&&this.hooks.onInit({animation:this})}render({driverProgress:e}){let t=e*1e4;if(this.hooks.onBeforeRender){const i=this.hooks.onBeforeRender({animation:this});if(typeof i=="number")t=i;else if(typeof i=="boolean"&&!i)return!1}this.cssAnimation.currentTime=t,this.hooks.onAfterRender&&this.hooks.onAfterRender({animation:this})}}class y{constructor({id:e,start:t,end:i,plugin:o,elements:r=[],hooks:m={}}){s(this,"id");s(this,"progress",0);s(this,"data",{});s(this,"start");s(this,"end");s(this,"plugin");s(this,"animations",new Map);s(this,"domElements",[]);s(this,"helper");s(this,"hooks");this.id=e,this.plugin=o,this.hooks=m,this.hooks.onBeforeInit&&this.hooks.onBeforeInit({driver:this}),this.start=new A({domElement:t,type:"start",driver:this}),this.end=new A({domElement:i,type:"end",driver:this}),this.helper=new b({id:e,pluginId:this.plugin.id}),r.forEach(n=>{const f=typeof n=="string"?n:n.selector;if(this.domElements=Array.from(document.querySelectorAll(f)),this.domElements.length===0)throw new Error(`Can't find element "${f}"`);this.domElements.forEach((E,B)=>{const v=E.getAnimations(),g=[];typeof n=="string"?(v.length,v.forEach(d=>{g.push({cssAnimation:d,hooks:{}})})):typeof n=="object"&&n.animations.forEach(d=>{let u="",p={};typeof d=="string"?u=d:typeof d=="object"&&(u=d.name,p=d.hooks);const I=v.find(L=>L.animationName===u);I&&g.push({cssAnimation:I,hooks:p})}),g.forEach(d=>{const u=`${this.id}---${f}---${B}---${d.cssAnimation.animationName}`,p=new k({id:u,driver:this,cssAnimation:d.cssAnimation,hooks:d.hooks,domElement:E});this.animations.set(u,p)})})}),this.hooks.onAfterInit&&this.hooks.onAfterInit({driver:this})}render({scroll:e,renderedInitially:t,consoleColor:i="#000000"}){const o=this.progress;if(this.progress=this.calculateProgress({scroll:e,start:this.start.top,end:this.end.top}),this.hooks.onBeforeRender){const r=this.hooks.onBeforeRender({driver:this});if(typeof r=="boolean"&&!r)return!1}if(o!==this.progress||!t){for(const r of this.animations.values())r.render({driverProgress:this.progress});this.hooks.onAfterRender&&this.hooks.onAfterRender({driver:this})}}calculateProgress({scroll:e,start:t,end:i}){let o=(e-t)/(i-t);return o<0?o=0:o>1?o=1:o=l(o,4),o}updateLimits({scroll:e,screenHeight:t}){this.start.updateLimits({scroll:e,screenHeight:t}),this.end.updateLimits({scroll:e,screenHeight:t});const i=this.start.top+t,o=this.end.top-i;this.helper.updateLimits({top:i,height:o-i}),this.hooks.onUpdateLimits&&this.hooks.onUpdateLimits({driver:this})}activate(){this.plugin.driverActiveInstances.add(this),this.hooks.onActivation&&this.hooks.onActivation({driver:this})}deactivate(){this.plugin.driverActiveInstances.delete(this),this.hooks.onDeactivation&&this.hooks.onDeactivation({driver:this})}}class A{constructor({domElement:e,type:t,driver:i}){s(this,"domElement");s(this,"top",0);if(!e)throw new Error(`Can't find "${t}" HTMLElement for driver "${i.id}"`);this.domElement=e}updateLimits({scroll:e,screenHeight:t}){this.top=~~this.domElement.getBoundingClientRect().top+e-t}}class b{constructor({id:e,pluginId:t}){s(this,"domElement");s(this,"pluginId");this.pluginId=t,this.domElement=document.createElement("i"),this.domElement.style.position="absolute",this.domElement.style.left="0",this.domElement.style.width="1px",this.domElement.setAttribute("data-supersonic-driver",e),this.domElement.setAttribute("data-supersonic-type","helper"),this.domElement.setAttribute("data-supersonic-plugin-id",this.pluginId),this.domElement.classList.add("supersonic-helper"),document.body.appendChild(this.domElement),this.domElement.style.left=`${Array.from(document.querySelectorAll("[data-supersonic-type='helper']")).indexOf(this.domElement)*5}px`,this.domElement.style.width="50px",this.domElement.style.background="blue",this.domElement.style.opacity="0.5"}updateLimits({top:e,height:t}){t<=0&&(t=1),this.domElement.style.setProperty("top",`${e}px`),this.domElement.style.setProperty("height",`${t}px`)}uninit(){this.domElement.remove()}}class R{constructor({observables:e,driverInstances:t}){s(this,"instance");this.instance=new IntersectionObserver(i=>{i.forEach(o=>{const m=o.target.dataset.supersonicDriver,n=t.get(m);if(!n)throw new Error(`Observer can't find driver "${m}"`);o.isIntersecting?n.activate():n.deactivate()})}),e.forEach(i=>{this.instance.observe(i)})}uninit(){this.instance.disconnect()}}class w{constructor({drivers:e,hooks:t={}}){s(this,"id");s(this,"scroll",0);s(this,"screenHeight",0);s(this,"renderedInitially",!1);s(this,"rafId",0);s(this,"consoleColor","#ffffff");s(this,"observer",null);s(this,"onResize",null);s(this,"data",{});s(this,"hooks",{});s(this,"driverInstances",new Map);s(this,"driverActiveInstances",new Set);var r,m;this.id=Math.random().toString(16).substring(2),this.hooks=t,(r=this.hooks)!=null&&r.onBeforeInit&&this.hooks.onBeforeInit({plugin:this});for(const n in e){const f=new y({id:n,hooks:e[n].hooks,start:e[n].start,end:e[n].end,elements:e[n].elements,plugin:this});this.driverInstances.set(n,f)}this.updateLimits();const i=Array.from(document.querySelectorAll(`[data-supersonic-type="helper"][data-supersonic-plugin-id="${this.id}"]`));this.observer=new R({observables:i,driverInstances:this.driverInstances});const o=()=>{var n;(n=this.hooks)!=null&&n.onBeforeResize&&this.hooks.onBeforeResize({plugin:this}),this.updateLimits(),this.render({useActiveDrivers:!1}),this.hooks.onAfterResize&&this.hooks.onAfterResize({plugin:this})};this.onResize=c(o,250),window.addEventListener("resize",this.onResize),this.render({useActiveDrivers:!1}),this.renderedInitially=!0,(m=this.hooks)!=null&&m.onAfterInit&&this.hooks.onAfterInit({plugin:this})}uninit(){for(const e of this.driverInstances.values())e.helper.uninit();this.driverInstances.clear(),this.driverActiveInstances.clear(),this.observer.uninit(),cancelAnimationFrame(this.rafId),window.removeEventListener("resize",this.onResize)}render({useActiveDrivers:e}){if(this.updateScroll(),this.hooks.onBeforeRender){const i=this.hooks.onBeforeRender({plugin:this});if(typeof i=="boolean"&&!i)return!1}const t=e?this.driverActiveInstances.values():this.driverInstances.values();for(const i of t)i.render({scroll:this.scroll,renderedInitially:this.renderedInitially,consoleColor:this.consoleColor});this.rafId=requestAnimationFrame(()=>{this.render({useActiveDrivers:!0})}),this.hooks.onAfterRender&&this.hooks.onAfterRender({plugin:this})}updateLimits(){this.updateScreenHeight(),this.updateScroll();for(const e of this.driverInstances.values())e.updateLimits({scroll:this.scroll,screenHeight:this.screenHeight})}updateScroll(){this.scroll=window.scrollY||document.documentElement.scrollTop}updateScreenHeight(){const e={position:"absolute",left:"0",top:"0",height:"100vh",width:"1px",zIndex:"-1",visibility:"hidden"},t=document.createElement("div");for(const i in e)t.style.setProperty(i,e[i]);document.body.appendChild(t),this.screenHeight=t.clientHeight,t.remove()}}return h.Animation=k,h.Driver=y,h.TheSupersonicPlugin=w,Object.defineProperty(h,Symbol.toStringTag,{value:"Module"}),h}({});

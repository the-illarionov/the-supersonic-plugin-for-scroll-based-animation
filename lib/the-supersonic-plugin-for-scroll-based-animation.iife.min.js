var TheSuperSonicPluginForScrollBasedAnimation=function(){"use strict";var P=Object.defineProperty;var $=(i,h,m)=>h in i?P(i,h,{enumerable:!0,configurable:!0,writable:!0,value:m}):i[h]=m;var s=(i,h,m)=>($(i,typeof h!="symbol"?h+"":h,m),m);const i={scroll:0,screenHeight:0,rafActive:!0,rafId:0,renderedInitially:!1,config:{options:{observerRootMargin:"100px"},drivers:{}},reset(){i.scroll=0,i.rafActive=!0,i.rafId=0,i.renderedInitially=!1},initConfig(l){var t,e,n;i.config={options:{...i.config.options,...l.options},drivers:(t=l.drivers)!=null?t:{},hooks:(e=l.hooks)!=null?e:{},elements:(n=l.elements)!=null?n:{}}}};function h(l){throw new Error(l)}function m(l,t){return t=10**t,~~(l*t)/t}const y=class{constructor({driverId:t,cssProperty:e,start:n,end:r,unit:o,hooks:a}){s(this,"driver");s(this,"cssProperty");s(this,"id");s(this,"start");s(this,"end");s(this,"hooks");s(this,"value",-1);s(this,"data",{});s(this,"unit");s(this,"elements",new Set);this.cssProperty=e,this.start=n,this.end=r,this.unit=o!=null?o:"",this.hooks=a!=null?a:{},this.id=`${t}---${e}`,this.driver=d.instances.get(t),y.instances.set(this.id,this),this.driver.properties.add(this),this.hooks.onInit&&this.hooks.onInit(this)}render(){this.value=this.calculateValue(),this.hooks.onBeforeRender&&this.hooks.onBeforeRender(this);for(let t of this.elements)t.addProperty(this);this.hooks.onAfterRender&&this.hooks.onAfterRender(this)}calculateValue(){let t=this.start instanceof Function?this.start(this):this.start,e=this.end instanceof Function?this.end(this):this.end;const n=this.driver.progress*(e-t)+t;let r=2;return this.unit==="px"&&(r=1),m(n,r)}updateLimits(){this.hooks.onUpdateLimits&&this.hooks.onUpdateLimits(this)}static init({drivers:t}){for(let e in t)if("properties"in t[e]){if("default"in t[e].properties){const r=Object.keys(t[e].properties);let o="default";for(let a of r)a!=="default"&&matchMedia(a).matches&&(o=a);t[e].properties=t[e].properties[o]}let n=t[e].properties;for(let r in n){const o=n[r];new y({driverId:e,cssProperty:r,start:o.start,end:o.end,unit:o.unit,hooks:o.hooks})}}}static uninit(){y.instances.clear()}};let v=y;s(v,"instances",new Map);const u=class{constructor({id:t,hooks:e}){s(this,"id");s(this,"domElements");s(this,"hooks");s(this,"data",{});s(this,"properties",new Map);s(this,"translate3d",{translateX:"0",translateY:"0",translateZ:"0"});this.id=t,this.hooks=e!=null?e:{},this.initDomElements(),this.saveInitialTranslate(),u.instances.set(this.id,this),this.hooks.onInit&&this.hooks.onInit(this)}saveInitialTranslate(){const t=window.getComputedStyle(this.domElements[0]).transform;if(t.includes("matrix")){const e=t.match(/matrix.*\((.+)\)/)[1].split(", "),n=t.includes("3d")?"3d":"2d";this.translate3d={translateX:(n==="2d"?e[4]:e[12])+"px",translateY:(n==="2d"?e[5]:e[13])+"px",translateZ:(n==="2d"?"0":e[14])+"px"}}}initDomElements(){this.domElements=Array.from(document.querySelectorAll(this.id)),this.domElements.length===0&&h(`Can't find Element: "${this.id}"`),this.domElements.forEach(t=>{t.setAttribute("data-supersonic-type","element"),t.setAttribute("data-supersonic-element-id",this.id)})}render(){this.hooks.onBeforeRender&&this.hooks.onBeforeRender(this);const t=this.calculateFlatProperties();for(let e in t)this.domElements.forEach(n=>{n.style.setProperty(e,t[e])});this.hooks.onAfterRender&&this.hooks.onAfterRender(this)}addProperty(t){if(!i.renderedInitially){const e=this.properties.get(t.cssProperty);if(e){const n=t.driver.initialDistanceToScroll,r=e.driver.initialDistanceToScroll,o=n<0,a=r<0;let c=!1;if(!o&&!a?c=n>r:!o&&a&&(c=n<r),c)return}}this.properties.set(t.cssProperty,t),this.hooks.onAddProperty&&this.hooks.onAddProperty(this,t)}calculateFlatProperties(){const t={};let e=!1;for(let n of this.properties.values()){const{cssProperty:r,value:o,unit:a}=n,c=o+a;u.translate3dKeys.includes(r)?(this.translate3d[r]=c,e=!0):r==="scale"?(b(t),t.transform+=`scale3d(${c}, ${c}, ${c}) `):u.transformKeys.includes(r)?(b(t),t.transform+=`${r}(${c}) `):t[r]=c}return e&&(b(t),t.transform+=`translate3d(${this.translate3d.translateX}, ${this.translate3d.translateY}, ${this.translate3d.translateZ}) `),t}updateLimits(t){this.hooks.onUpdateLimits&&this.hooks.onUpdateLimits(this,t)}static init({drivers:t,elements:e}){for(let n in t){const r=d.instances.get(n),o=t[n].properties;for(let a in o){const c=v.instances.get(`${n}---${a}`);for(let k of o[a].elements){let I=u.instances.get(k);if(!I){let A;e&&e[k]&&e[k].hooks&&(A=e[k].hooks),I=new u({id:k,hooks:A})}r.elements.add(I),c.elements.add(I)}}}}static uninit(){u.instances.clear()}static render(){for(let t of u.activeInstances.values())t.render();u.activeInstances.clear()}};let p=u;s(p,"instances",new Map),s(p,"activeInstances",new Set),s(p,"transformKeys",["perspective","scaleX","scaleY","scale","skewX","skewY","skew","rotateX","rotateY","rotate"]),s(p,"translate3dKeys",["translateX","translateY","translateZ"]);function b(l){l.transform||(l.transform="")}const f=class{constructor({id:t,hooks:e}){s(this,"id");s(this,"progress",0);s(this,"active",!1);s(this,"initialDistanceToScroll",0);s(this,"data",{});s(this,"start");s(this,"end");s(this,"properties",new Set);s(this,"elements",new Set);s(this,"helper");s(this,"hooks");this.id=t,this.hooks=e!=null?e:{},this.initBorders(),this.helper=new w({driver:this}),f.instances.set(t,this),this.hooks.onInit&&this.hooks.onInit(this)}initBorders(){const t=`[data-supersonic-driver="${this.id}"]`,e=`${t}[data-supersonic-type="start"]`,n=`${t}[data-supersonic-type="end"]`;this.start=new L({domElement:document.querySelector(e),selector:e}),this.end=new L({domElement:document.querySelector(n),selector:n})}render(){const t=this.progress;if(this.progress=this.calculateProgress(),this.hooks.onBeforeRender&&this.hooks.onBeforeRender(this),t!==this.progress||!i.renderedInitially){for(let e of this.properties)e.render();for(let e of this.elements)p.activeInstances.add(e);this.hooks.onAfterRender&&this.hooks.onAfterRender(this)}}calculateProgress(){let t=(i.scroll-this.start.top)/(this.end.top-this.start.top);return t<0?t=0:t>1?t=1:t=m(t,4),t}updateLimits(){this.start.updateLimits(),this.end.updateLimits(),this.end.top<this.start.top&&(this.end.top+=i.screenHeight),this.helper.updateLimits();for(let t of this.properties)t.updateLimits();for(let t of this.elements)t.updateLimits(this);this.hooks.onUpdateLimits&&this.hooks.onUpdateLimits(this)}activate(){this.active=!0,f.activeInstances.add(this),this.hooks.onActivation&&this.hooks.onActivation(this)}deactivate(){this.active=!1,f.activeInstances.delete(this),this.hooks.onDeactivation&&this.hooks.onDeactivation(this)}static init({drivers:t}){for(let e in t)new f({id:e,hooks:t[e].hooks})}static uninit(){for(let t of f.instances.values())t.helper.uninit();f.instances.clear()}static render({useActiveDrivers:t}){const e=t?f.activeInstances.values():f.instances.values();for(let n of e)i.renderedInitially||(n.initialDistanceToScroll=n.end.top-i.scroll),n.render()}static updateLimits(){for(let t of f.instances.values())t.updateLimits()}};let d=f;s(d,"instances",new Map),s(d,"activeInstances",new Set);class L{constructor({domElement:t,selector:e}){s(this,"domElement");s(this,"top",0);s(this,"edge","bottom");t||h(`Can't find DOM element: ${e}"]`),t.dataset.supersonicEdge==="top"&&(this.edge="top"),this.domElement=t}updateLimits(){this.top=~~this.domElement.getBoundingClientRect().top+i.scroll,this.edge==="bottom"&&(this.top-=i.screenHeight)}}const E=class{constructor({driver:t}){s(this,"domElement");s(this,"driver");this.driver=t,this.domElement=document.createElement("i");for(let e in E.styles)this.domElement.style.setProperty(e,E.styles[e]);this.domElement.setAttribute("data-supersonic-driver",t.id),this.domElement.setAttribute("data-supersonic-type","helper"),this.domElement.classList.add("supersonic-helper"),document.body.appendChild(this.domElement)}updateLimits(){let t=this.driver.start.top,e=this.driver.end.top;this.driver.start.edge==="bottom"&&(t+=i.screenHeight),this.driver.end.edge==="bottom"&&(e+=i.screenHeight),this.domElement.style.setProperty("top",t+"px"),this.domElement.style.setProperty("height",e-t+"px")}uninit(){this.domElement.remove()}};let w=E;s(w,"styles",{position:"absolute",left:0,width:"1px"});class R{constructor(t){s(this,"instance");this.instance=new IntersectionObserver(e=>{e.forEach(n=>{const o=n.target.dataset.supersonicDriver,a=d.instances.get(o);if(!a){h(`Observer can't find driver "${o}"`);return}n.isIntersecting?a.activate():a.deactivate()})},{rootMargin:i.config.options.observerRootMargin}),t.forEach(e=>{this.instance.observe(e)})}uninit(){this.instance.disconnect()}}class g{constructor(t){s(this,"observer",null);s(this,"onResize",null);var e;i.initConfig(t),this.initInstances(),this.updateLimits(),this.initObserver(),this.addEventListeners(),this.render({useActiveDrivers:!1}),i.renderedInitially=!0,(e=i.config.hooks)!=null&&e.onInit&&i.config.hooks.onInit(this)}uninit(){d.uninit(),v.uninit(),p.uninit(),this.removeEventListeners(),this.observer.uninit(),this.observer=null,i.reset()}initInstances(){const t=i.config.drivers,e=i.config.elements;d.init({drivers:t}),v.init({drivers:t}),p.init({drivers:t,elements:e})}initObserver(){const t=Array.from(document.querySelectorAll('[data-supersonic-type="helper"]'));this.observer=new R(t)}render({useActiveDrivers:t}){const e=i.config.hooks;i.rafActive&&(this.updateScroll(),e.onBeforeRender&&e.onBeforeRender(),d.render({useActiveDrivers:t}),p.render(),i.rafId=requestAnimationFrame(()=>{this.render({useActiveDrivers:!0})}),e.onAfterRender&&e.onAfterRender())}updateLimits(){this.updateScreenHeight(),this.updateScroll(),d.updateLimits(),i.config.hooks.onUpdateLimits&&i.config.hooks.onUpdateLimits()}updateScroll(){i.scroll=window.scrollY||window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop}updateScreenHeight(){const t={position:"absolute",left:"0",top:"0",height:"100vh",width:"1px",zIndex:"-1",visibility:"hidden"};let e=document.createElement("div");for(let n in t)e.style.setProperty(n,t[n]);document.body.appendChild(e),i.screenHeight=e.clientHeight,e.remove()}addEventListeners(){this.onResize=()=>{this.updateLimits(),this.render({useActiveDrivers:!1})},window.addEventListener("resize",this.onResize)}removeEventListeners(){window.removeEventListener("resize",this.onResize)}}return s(g,"Driver",d),s(g,"Property",v),s(g,"Element",p),s(g,"Globals",i),g}();

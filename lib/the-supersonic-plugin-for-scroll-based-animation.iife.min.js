var TheSuperSonicPluginForScrollBasedAnimation=function(){"use strict";var $=Object.defineProperty;var x=(r,h,m)=>h in r?$(r,h,{enumerable:!0,configurable:!0,writable:!0,value:m}):r[h]=m;var s=(r,h,m)=>(x(r,typeof h!="symbol"?h+"":h,m),m);const r={scroll:0,rafActive:!0,rafId:0,renderedInitially:!1,config:{options:{observerRootMargin:"100px"},drivers:{}},reset(){r.scroll=0,r.rafActive=!0,r.rafId=0,r.renderedInitially=!1},initConfig(d){var t,e,i;r.config={options:{...r.config.options,...d.options},drivers:(t=d.drivers)!=null?t:{},hooks:(e=d.hooks)!=null?e:{},elements:(i=d.elements)!=null?i:{}}}};function h(d){throw new Error(d)}function m(d,t){return t=10**t,~~(d*t)/t}const g=class{constructor({driverId:t,cssProperty:e,start:i,end:n,unit:o,hooks:a}){s(this,"driver");s(this,"cssProperty");s(this,"id");s(this,"start");s(this,"end");s(this,"hooks");s(this,"value",-1);s(this,"data",{});s(this,"unit");s(this,"elements",new Set);this.cssProperty=e,this.start=i,this.end=n,this.unit=o!=null?o:"",this.hooks=a!=null?a:{},this.id=`${t}---${e}`,this.driver=l.instances.get(t),g.instances.set(this.id,this),this.driver.properties.add(this),this.hooks.onInit&&this.hooks.onInit(this)}render(){this.value=this.calculateValue(),this.hooks.onBeforeRender&&this.hooks.onBeforeRender(this);for(let t of this.elements)t.addProperty(this);this.hooks.onAfterRender&&this.hooks.onAfterRender(this)}calculateValue(){let t=this.start instanceof Function?this.start(this):this.start,e=this.end instanceof Function?this.end(this):this.end;const i=this.driver.progress*(e-t)+t;let n=2;return this.unit==="px"&&(n=1),m(i,n)}updateLimits(){this.hooks.onUpdateLimits&&this.hooks.onUpdateLimits(this)}static init({drivers:t}){for(let e in t)if("properties"in t[e]){if("default"in t[e].properties){const n=Object.keys(t[e].properties);let o="default";for(let a of n)a!=="default"&&matchMedia(a).matches&&(o=a);t[e].properties=t[e].properties[o]}let i=t[e].properties;for(let n in i){const o=i[n];new g({driverId:e,cssProperty:n,start:o.start,end:o.end,unit:o.unit,hooks:o.hooks})}}}static uninit(){g.instances.clear()}};let v=g;s(v,"instances",new Map);const u=class{constructor({id:t,hooks:e}){s(this,"id");s(this,"domElements");s(this,"hooks");s(this,"data",{});s(this,"properties",new Map);s(this,"translate3d",{translateX:"0",translateY:"0",translateZ:"0"});this.id=t,this.hooks=e!=null?e:{},this.initDomElements(),this.saveInitialTranslate(),u.instances.set(this.id,this),this.hooks.onInit&&this.hooks.onInit(this)}saveInitialTranslate(){const t=window.getComputedStyle(this.domElements[0]).transform;if(t.includes("matrix")){const e=t.match(/matrix.*\((.+)\)/)[1].split(", "),i=t.includes("3d")?"3d":"2d";this.translate3d={translateX:(i==="2d"?e[4]:e[12])+"px",translateY:(i==="2d"?e[5]:e[13])+"px",translateZ:(i==="2d"?"0":e[14])+"px"}}}initDomElements(){this.domElements=Array.from(document.querySelectorAll(this.id)),this.domElements.length===0&&h(`Can't find Element: "${this.id}"`),this.domElements.forEach(t=>{t.setAttribute("data-supersonic-type","element"),t.setAttribute("data-supersonic-element-id",this.id)})}render(){this.hooks.onBeforeRender&&this.hooks.onBeforeRender(this);const t=this.calculateFlatProperties();for(let e in t)this.domElements.forEach(i=>{i.style.setProperty(e,t[e])});this.hooks.onAfterRender&&this.hooks.onAfterRender(this)}addProperty(t){if(!r.renderedInitially){const e=this.properties.get(t.cssProperty);if(e){const i=t.driver.initialDistanceToScroll,n=e.driver.initialDistanceToScroll,o=i<0,a=n<0;let c=!1;if(!o&&!a?c=i>n:!o&&a&&(c=i<n),c)return}}this.properties.set(t.cssProperty,t),this.hooks.onAddProperty&&this.hooks.onAddProperty(this,t)}calculateFlatProperties(){const t={};let e=!1;for(let i of this.properties.values()){const{cssProperty:n,value:o,unit:a}=i,c=o+a;u.translate3dKeys.includes(n)?(this.translate3d[n]=c,e=!0):n==="scale"?(L(t),t.transform+=`scale3d(${c}, ${c}, ${c}) `):u.transformKeys.includes(n)?(L(t),t.transform+=`${n}(${c}) `):t[n]=c}return e&&(L(t),t.transform+=`translate3d(${this.translate3d.translateX}, ${this.translate3d.translateY}, ${this.translate3d.translateZ}) `),t}updateLimits(t){this.hooks.onUpdateLimits&&this.hooks.onUpdateLimits(this,t)}static init({drivers:t,elements:e}){for(let i in t){const n=l.instances.get(i),o=t[i].properties;for(let a in o){const c=v.instances.get(`${i}---${a}`);for(let w of o[a].elements){let I=u.instances.get(w);if(!I){let A;e&&e[w]&&e[w].hooks&&(A=e[w].hooks),I=new u({id:w,hooks:A})}n.elements.add(I),c.elements.add(I)}}}}static uninit(){u.instances.clear()}static render(){for(let t of u.activeInstances.values())t.render();u.activeInstances.clear()}};let p=u;s(p,"instances",new Map),s(p,"activeInstances",new Set),s(p,"transformKeys",["perspective","scaleX","scaleY","scale","skewX","skewY","skew","rotateX","rotateY","rotate"]),s(p,"translate3dKeys",["translateX","translateY","translateZ"]);function L(d){d.transform||(d.transform="")}const f=class{constructor({id:t,hooks:e}){s(this,"id");s(this,"progress",0);s(this,"active",!1);s(this,"initialDistanceToScroll",0);s(this,"data",{});s(this,"start");s(this,"end");s(this,"properties",new Set);s(this,"elements",new Set);s(this,"helper");s(this,"hooks");this.id=t,this.hooks=e!=null?e:{},this.initBorders(),this.helper=new k({driver:this}),f.instances.set(t,this),this.hooks.onInit&&this.hooks.onInit(this)}initBorders(){const t=`[data-supersonic-driver="${this.id}"]`,e=`${t}[data-supersonic-type="start"]`,i=`${t}[data-supersonic-type="end"]`;this.start=new b({domElement:document.querySelector(e),selector:e}),this.end=new b({domElement:document.querySelector(i),selector:i})}render(){const t=this.progress;if(this.progress=this.calculateProgress(),this.hooks.onBeforeRender&&this.hooks.onBeforeRender(this),t!==this.progress||!r.renderedInitially){for(let e of this.properties)e.render();for(let e of this.elements)p.activeInstances.add(e);this.hooks.onAfterRender&&this.hooks.onAfterRender(this)}}calculateProgress(){let t=(r.scroll-this.start.top)/(this.end.top-this.start.top);return t<0?t=0:t>1?t=1:t=m(t,4),t}updateLimits(){this.start.updateLimits(),this.end.updateLimits(),this.end.top<this.start.top&&(this.end.top+=window.innerHeight),this.helper.updateLimits();for(let t of this.properties)t.updateLimits();for(let t of this.elements)t.updateLimits(this);this.hooks.onUpdateLimits&&this.hooks.onUpdateLimits(this)}activate(){this.active=!0,f.activeInstances.add(this),this.hooks.onActivation&&this.hooks.onActivation(this)}deactivate(){this.active=!1,f.activeInstances.delete(this),this.hooks.onDeactivation&&this.hooks.onDeactivation(this)}static init({drivers:t}){for(let e in t)new f({id:e,hooks:t[e].hooks})}static uninit(){for(let t of f.instances.values())t.helper.uninit();f.instances.clear()}static render({useActiveDrivers:t}){const e=t?f.activeInstances.values():f.instances.values();for(let i of e)r.renderedInitially||(i.initialDistanceToScroll=i.end.top-r.scroll),i.render()}static updateLimits(){for(let t of f.instances.values())t.updateLimits()}};let l=f;s(l,"instances",new Map),s(l,"activeInstances",new Set);class b{constructor({domElement:t,selector:e}){s(this,"domElement");s(this,"top",0);s(this,"edge","bottom");t||h(`Can't find DOM element: ${e}"]`),t.dataset.supersonicEdge==="top"&&(this.edge="top"),this.domElement=t}updateLimits(){this.top=this.domElement.getBoundingClientRect().top+r.scroll,this.edge==="bottom"&&(this.top-=window.innerHeight)}}const E=class{constructor({driver:t}){s(this,"domElement");s(this,"driver");this.driver=t,this.domElement=document.createElement("i");for(let e in E.styles)this.domElement.style.setProperty(e,E.styles[e]);this.domElement.setAttribute("data-supersonic-driver",t.id),this.domElement.setAttribute("data-supersonic-type","helper"),this.domElement.classList.add("supersonic-helper"),document.body.appendChild(this.domElement)}updateLimits(){let t=this.driver.start.top,e=this.driver.end.top;this.driver.start.edge==="bottom"&&(t+=window.innerHeight),this.driver.end.edge==="bottom"&&(e+=window.innerHeight),this.domElement.style.setProperty("top",t+"px"),this.domElement.style.setProperty("height",e-t+"px")}uninit(){this.domElement.remove()}};let k=E;s(k,"styles",{position:"absolute",left:0,width:"1px"});class R{constructor(t){s(this,"instance");this.instance=new IntersectionObserver(e=>{e.forEach(i=>{const o=i.target.dataset.supersonicDriver,a=l.instances.get(o);if(!a){h(`Observer can't find driver "${o}"`);return}i.isIntersecting?a.activate():a.deactivate()})},{rootMargin:r.config.options.observerRootMargin}),t.forEach(e=>{this.instance.observe(e)})}uninit(){this.instance.disconnect()}}class y{constructor(t){s(this,"observer",null);s(this,"resizeWrapper",null);var e;r.initConfig(t),this.initInstances(),this.updateLimits(),this.initObserver(),this.addEventListeners(),this.render({useActiveDrivers:!1}),r.renderedInitially=!0,(e=r.config.hooks)!=null&&e.onInit&&r.config.hooks.onInit(this)}uninit(){l.uninit(),v.uninit(),p.uninit(),this.removeEventListeners(),this.observer.uninit(),this.observer=null,r.reset()}initInstances(){const t=r.config.drivers,e=r.config.elements;l.init({drivers:t}),v.init({drivers:t}),p.init({drivers:t,elements:e})}initObserver(){const t=Array.from(document.querySelectorAll('[data-supersonic-type="helper"]'));this.observer=new R(t)}render({useActiveDrivers:t}){const e=r.config.hooks;r.rafActive&&(this.updateScroll(),e.onBeforeRender&&e.onBeforeRender(),l.render({useActiveDrivers:t}),p.render(),r.rafId=requestAnimationFrame(()=>{this.render({useActiveDrivers:!0})}),e.onAfterRender&&e.onAfterRender())}updateLimits(){this.updateScroll(),l.updateLimits(),r.config.hooks.onUpdateLimits&&r.config.hooks.onUpdateLimits()}updateScroll(){r.scroll=window.pageYOffset||window.scrollY||document.documentElement.scrollTop||document.body.scrollTop}addEventListeners(){this.resizeWrapper=P(()=>{this.updateLimits(),this.render({useActiveDrivers:!1})}),window.addEventListener("resize",this.onResize.bind(this))}removeEventListeners(){window.removeEventListener("resize",this.onResize)}onResize(){this.resizeWrapper()}}s(y,"Driver",l),s(y,"Property",v),s(y,"Element",p),s(y,"Globals",r);function P(d){let t;return()=>{clearTimeout(t),t=setTimeout(()=>{d.apply(this)},500)}}return y}();

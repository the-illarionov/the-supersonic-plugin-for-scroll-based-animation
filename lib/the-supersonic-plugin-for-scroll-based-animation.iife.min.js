var TheSuperSonicPluginForScrollBasedAnimation=function(){"use strict";var $=Object.defineProperty;var x=(i,h,m)=>h in i?$(i,h,{enumerable:!0,configurable:!0,writable:!0,value:m}):i[h]=m;var s=(i,h,m)=>(x(i,typeof h!="symbol"?h+"":h,m),m);const i={scroll:0,rafActive:!0,rafId:0,renderedInitially:!1,config:{options:{observerRootMargin:"100px"},drivers:{}},reset(){i.scroll=0,i.rafActive=!0,i.rafId=0,i.renderedInitially=!1},initConfig(d){var t,e,r;i.config={options:{...i.config.options,...d.options},drivers:(t=d.drivers)!=null?t:{},hooks:(e=d.hooks)!=null?e:{},elements:(r=d.elements)!=null?r:{}}}};function h(d){throw new Error(d)}function m(d,t){return t=10**t,~~(d*t)/t}const g=class{constructor({driverId:t,cssProperty:e,start:r,end:n,unit:o,hooks:a}){s(this,"driver");s(this,"cssProperty");s(this,"id");s(this,"start");s(this,"end");s(this,"hooks");s(this,"value",-1);s(this,"data",{});s(this,"unit");s(this,"elements",new Set);this.cssProperty=e,this.start=r,this.end=n,this.unit=o!=null?o:"",this.hooks=a!=null?a:{},this.id=`${t}---${e}`,this.driver=l.instances.get(t),g.instances.set(this.id,this),this.driver.properties.add(this),this.hooks.onInit&&this.hooks.onInit(this)}render(){this.value=this.calculateValue(),this.hooks.onBeforeRender&&this.hooks.onBeforeRender(this);for(let t of this.elements)t.addProperty(this);this.hooks.onAfterRender&&this.hooks.onAfterRender(this)}calculateValue(){let t=this.start instanceof Function?this.start(this):this.start,e=this.end instanceof Function?this.end(this):this.end;const r=this.driver.progress*(e-t)+t;let n=2;return this.unit==="px"&&(n=1),m(r,n)}updateLimits(){this.hooks.onUpdateLimits&&this.hooks.onUpdateLimits(this)}static init({drivers:t}){for(let e in t)if("properties"in t[e]){if("default"in t[e].properties){const n=Object.keys(t[e].properties);let o="default";for(let a of n)a!=="default"&&matchMedia(a).matches&&(o=a);t[e].properties=t[e].properties[o]}let r=t[e].properties;for(let n in r){const o=r[n];new g({driverId:e,cssProperty:n,start:o.start,end:o.end,unit:o.unit,hooks:o.hooks})}}}static uninit(){g.instances.clear()}};let v=g;s(v,"instances",new Map);const u=class{constructor({id:t,hooks:e}){s(this,"id");s(this,"domElements");s(this,"hooks");s(this,"data",{});s(this,"properties",new Map);s(this,"translate3d",{translateX:"0",translateY:"0",translateZ:"0"});this.id=t,this.hooks=e!=null?e:{},this.initDomElements(),this.saveInitialTranslate(),u.instances.set(this.id,this),this.hooks.onInit&&this.hooks.onInit(this)}saveInitialTranslate(){const t=window.getComputedStyle(this.domElements[0]).transform;if(t.includes("matrix")){const e=t.match(/matrix.*\((.+)\)/)[1].split(", "),r=t.includes("3d")?"3d":"2d";this.translate3d={translateX:(r==="2d"?e[4]:e[12])+"px",translateY:(r==="2d"?e[5]:e[13])+"px",translateZ:(r==="2d"?"0":e[14])+"px"}}}initDomElements(){this.domElements=Array.from(document.querySelectorAll(this.id)),this.domElements.length===0&&h(`Can't find Element: "${this.id}"`),this.domElements.forEach(t=>{t.setAttribute("data-supersonic-type","element"),t.setAttribute("data-supersonic-element-id",this.id)})}render(){this.hooks.onBeforeRender&&this.hooks.onBeforeRender(this);const t=this.calculateFlatProperties();for(let e in t)this.domElements.forEach(r=>{r.style.setProperty(e,t[e])});this.hooks.onAfterRender&&this.hooks.onAfterRender(this)}addProperty(t){if(!i.renderedInitially){const e=this.properties.get(t.cssProperty);if(e){const r=t.driver.initialDistanceToScroll,n=e.driver.initialDistanceToScroll,o=r<0,a=n<0;let c=!1;if(!o&&!a?c=r>n:!o&&a&&(c=r<n),c)return}}this.properties.set(t.cssProperty,t),this.hooks.onAddProperty&&this.hooks.onAddProperty(this,t)}calculateFlatProperties(){const t={};let e=!1;for(let r of this.properties.values()){const{cssProperty:n,value:o,unit:a}=r,c=o+a;u.translate3dKeys.includes(n)?(this.translate3d[n]=c,e=!0):n==="scale"?(L(t),t.transform+=`scale3d(${c}, ${c}, ${c}) `):u.transformKeys.includes(n)?(L(t),t.transform+=`${n}(${c}) `):t[n]=c}return e&&(L(t),t.transform+=`translate3d(${this.translate3d.translateX}, ${this.translate3d.translateY}, ${this.translate3d.translateZ}) `),t}updateLimits(t){this.hooks.onUpdateLimits&&this.hooks.onUpdateLimits(this,t)}static init({drivers:t,elements:e}){for(let r in t){const n=l.instances.get(r),o=t[r].properties;for(let a in o){const c=v.instances.get(`${r}---${a}`);for(let w of o[a].elements){let E=u.instances.get(w);if(!E){let A;e&&e[w]&&e[w].hooks&&(A=e[w].hooks),E=new u({id:w,hooks:A})}n.elements.add(E),c.elements.add(E)}}}}static uninit(){u.instances.clear()}static render(){for(let t of u.activeInstances.values())t.render();u.activeInstances.clear()}};let f=u;s(f,"instances",new Map),s(f,"activeInstances",new Set),s(f,"transformKeys",["perspective","scaleX","scaleY","scale","skewX","skewY","skew","rotateX","rotateY","rotate"]),s(f,"translate3dKeys",["translateX","translateY","translateZ"]);function L(d){d.transform||(d.transform="")}const p=class{constructor({id:t,hooks:e}){s(this,"id");s(this,"progress",0);s(this,"active",!1);s(this,"initialDistanceToScroll",0);s(this,"data",{});s(this,"start");s(this,"end");s(this,"properties",new Set);s(this,"elements",new Set);s(this,"helper");s(this,"hooks");this.id=t,this.hooks=e!=null?e:{},this.initBorders(),this.helper=new k({driver:this}),p.instances.set(t,this),this.hooks.onInit&&this.hooks.onInit(this)}initBorders(){const t=`[data-supersonic-driver="${this.id}"]`,e=`${t}[data-supersonic-type="start"]`,r=`${t}[data-supersonic-type="end"]`;this.start=new b({domElement:document.querySelector(e),selector:e}),this.end=new b({domElement:document.querySelector(r),selector:r})}render(){const t=this.progress;if(this.progress=this.calculateProgress(),this.hooks.onBeforeRender&&this.hooks.onBeforeRender(this),t!==this.progress||!i.renderedInitially){for(let e of this.properties)e.render();for(let e of this.elements)f.activeInstances.add(e);this.hooks.onAfterRender&&this.hooks.onAfterRender(this)}}calculateProgress(){let t=(i.scroll-this.start.top)/(this.end.top-this.start.top);return t<0?t=0:t>1?t=1:t=m(t,4),t}updateLimits(){this.start.updateLimits(),this.end.updateLimits(),this.end.top<this.start.top&&(this.end.top+=window.innerHeight),this.helper.updateLimits();for(let t of this.properties)t.updateLimits();for(let t of this.elements)t.updateLimits(this);this.hooks.onUpdateLimits&&this.hooks.onUpdateLimits(this)}activate(){this.active=!0,p.activeInstances.add(this),this.hooks.onActivation&&this.hooks.onActivation(this)}deactivate(){this.active=!1,p.activeInstances.delete(this),this.hooks.onDeactivation&&this.hooks.onDeactivation(this)}static init({drivers:t}){for(let e in t)new p({id:e,hooks:t[e].hooks})}static uninit(){for(let t of p.instances.values())t.helper.uninit();p.instances.clear()}static render({useActiveDrivers:t}){const e=t?p.activeInstances.values():p.instances.values();for(let r of e)i.renderedInitially||(r.initialDistanceToScroll=r.end.top-i.scroll),r.render()}static updateLimits(){for(let t of p.instances.values())t.updateLimits()}};let l=p;s(l,"instances",new Map),s(l,"activeInstances",new Set);class b{constructor({domElement:t,selector:e}){s(this,"domElement");s(this,"top",0);s(this,"edge","bottom");t||h(`Can't find DOM element: ${e}"]`),t.dataset.supersonicEdge==="top"&&(this.edge="top"),this.domElement=t}updateLimits(){this.top=this.domElement.getBoundingClientRect().top+i.scroll,this.edge==="bottom"&&(this.top-=window.innerHeight)}}const I=class{constructor({driver:t}){s(this,"domElement");s(this,"driver");this.driver=t,this.domElement=document.createElement("i");for(let e in I.styles)this.domElement.style.setProperty(e,I.styles[e]);this.domElement.setAttribute("data-supersonic-driver",t.id),this.domElement.setAttribute("data-supersonic-type","helper"),this.domElement.classList.add("supersonic-helper"),document.body.appendChild(this.domElement)}updateLimits(){let t=this.driver.start.top,e=this.driver.end.top;this.driver.start.edge==="bottom"&&(t+=window.innerHeight),this.driver.end.edge==="bottom"&&(e+=window.innerHeight),this.domElement.style.setProperty("top",t+"px"),this.domElement.style.setProperty("height",e-t+"px")}uninit(){this.domElement.remove()}};let k=I;s(k,"styles",{position:"absolute",left:0,width:"1px"});class R{constructor(t){s(this,"instance");this.instance=new IntersectionObserver(e=>{e.forEach(r=>{const o=r.target.dataset.supersonicDriver,a=l.instances.get(o);if(!a){h(`Observer can't find driver "${o}"`);return}r.isIntersecting?a.activate():a.deactivate()})},{rootMargin:i.config.options.observerRootMargin}),t.forEach(e=>{this.instance.observe(e)})}uninit(){this.instance.disconnect()}}class y{constructor(t){s(this,"observer",null);s(this,"resizeWrapper",null);var e;i.initConfig(t),this.initInstances(),this.updateLimits(),this.initObserver(),this.addEventListeners(),this.render({useActiveDrivers:!1}),i.renderedInitially=!0,(e=i.config.hooks)!=null&&e.onInit&&i.config.hooks.onInit(this)}uninit(){l.uninit(),v.uninit(),f.uninit(),this.removeEventListeners(),this.observer.uninit(),this.observer=null,i.reset()}initInstances(){const t=i.config.drivers,e=i.config.elements;l.init({drivers:t}),v.init({drivers:t}),f.init({drivers:t,elements:e})}initObserver(){const t=Array.from(document.querySelectorAll('[data-supersonic-type="helper"]'));this.observer=new R(t)}render({useActiveDrivers:t}){const e=i.config.hooks;i.rafActive&&(this.updateScroll(),e.onBeforeRender&&e.onBeforeRender(),l.render({useActiveDrivers:t}),f.render(),i.rafId=requestAnimationFrame(()=>{this.render({useActiveDrivers:!0})}),e.onAfterRender&&e.onAfterRender())}updateLimits(){this.updateScroll(),l.updateLimits(),i.config.hooks.onUpdateLimits&&i.config.hooks.onUpdateLimits()}updateScroll(){i.scroll=window.pageYOffset||window.scrollY||document.documentElement.scrollTop||document.body.scrollTop}addEventListeners(){this.resizeWrapper=P(()=>{i.rafActive=!0,this.updateLimits(),this.render({useActiveDrivers:!1})}),window.addEventListener("resize",this.onResize.bind(this))}removeEventListeners(){window.removeEventListener("resize",this.onResize)}onResize(){cancelAnimationFrame(i.rafId),i.rafActive=!1,this.resizeWrapper()}}s(y,"Driver",l),s(y,"Property",v),s(y,"Element",f),s(y,"Globals",i);function P(d){let t;return()=>{clearTimeout(t),t=setTimeout(()=>{d.apply(this)},500)}}return y}();
